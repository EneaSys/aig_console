<form [formGroup]="formGroup" (ngSubmit)="submit()" *ngIf="step.form">

    <div fxLayout="row" fxLayoutAlign="start start">
        <mat-form-field class="mr-8 ml-8" appearance="outline" fxFlex>
            <mat-label>Gruppo al quale associare</mat-label>
            <mat-icon matSuffix class="secondary-text">assignment_ind</mat-icon>
            <input type="text" matInput formControlName="groupParent" required [matAutocomplete]="groupParentAutocomplete">
            <mat-autocomplete #groupParentAutocomplete="matAutocomplete" [displayWith]="groupDisplayFn">
                <mat-option *ngFor="let group of filteredParentGroups | async" [value]="group">{{ group.name }}</mat-option>
            </mat-autocomplete>
            <mat-error>E' necessario selezionare un gruppo!</mat-error>
        </mat-form-field>
    </div>

    <div fxLayout="row" fxLayoutAlign="start start">
        <mat-form-field class="mr-8 ml-8" appearance="outline" fxFlex>
            <mat-label>Gruppo da associare</mat-label>
            <mat-icon matSuffix class="secondary-text">star_half</mat-icon>
            <input type="text" matInput formControlName="groupChild" required [matAutocomplete]="groupChildAutocomplete">
            <mat-autocomplete #groupChildAutocomplete="matAutocomplete" [displayWith]="groupDisplayFn">
                <mat-option *ngFor="let group of filteredChildGroups | async" [value]="group">{{ group.name }}</mat-option>
            </mat-autocomplete>
            <mat-error>E' necessario selezionare un gruppo o un utente!</mat-error>
        </mat-form-field>
        <mat-form-field class="mr-8 ml-8" appearance="outline" fxFlex>
            <mat-label>Utente da associare</mat-label>
            <mat-icon matSuffix class="secondary-text">star_half</mat-icon>
            <input type="text" matInput formControlName="user" required [matAutocomplete]="userAutocomplete">
            <mat-autocomplete #userAutocomplete="matAutocomplete" [displayWith]="userDisplayFn">
                <mat-option *ngFor="let user of filteredUsers | async" [value]="user">{{ user.email }}</mat-option>
            </mat-autocomplete>
            <mat-error>E' necessario selezionare un utente o un gruppo!</mat-error>
        </mat-form-field>
    </div>

    <div fxLayout="row" fxLayoutAlign="end top">
        <button type="submit" mat-raised-button color="accent">Aggiungi</button>
    </div>

</form>

<div *ngIf="step.loading" fxLayoutAlign="center">
    <mat-spinner></mat-spinner>
</div>

<div *ngIf="step.complete">
    Associazione effettuata
</div>